---
metadata:
  title: Roles and Permissions
  description: TODO
converter: markdown
---

## Authentication vs. Authorization

Although the terms are often used together, authentication and authorization solve two very different problems.

### Authentication: *Who are you?*

Authentication verifies the identity of the visitor. Whenever a user logs in, platformOS creates a session and exposes the authenticated user through:

{% raw %} `{{ context.current_user }}` {% endraw %}

This object exists only when a valid session cookie is present. This is what we used so far when creating the dynamic navigation.

### Authorization: *What are you allowed to do?*

Authorization determines whether the authenticated user is allowed to perform a specific action.

{% include 'alert/tutorial', content: 'For detailed guidance on RBAC, complete with copy-pasteable examples, refer to the <a href="https://github.com/Platform-OS/pos-module-user?tab=readme-ov-file#rbac-authorization" target="_blank">RBAC Authorization section</a> of the User Module README.' %}

In platformOS, authorization is based on:

* **Profiles**
* **Roles** assigned to those profiles
* **Permissions** attached to those roles

The User Module provides helpers such as:

{% raw %}
```liquid
function can = 'modules/user/helpers/can_do', requester: current_profile, do: 'admin.view'
```
{% endraw %}

This returns `true` or `false` depending on whether the profile has at least one role containing the requested permission.

You’ll use these helpers shortly when protecting the `/admin` page.

## Built-In Roles (provided by the User Module)

When you install the User Module, several roles already exist:

| **Role**            | **Description**                                                                                                                                                                                                                                |
| ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **`anonymous`**     | Assigned automatically when no user is logged in. Used to grant access to pages such as `/sessions/new` (login), `/users/new` (registration), and `/passwords/reset` (request reset link). These pages should not require a logged-in session. |
| **`authenticated`** | Assigned to every logged-in user. Useful for pages like a dashboard, profile management, or anything that should only be visible after login.                                                                                                  |
| **`admin`**         | Includes permissions related to administrative management.  |
| **`superadmin`**    | Has full access to everything. This role is typically reserved for high-level operations and should not be modified.                                                                                                                           |

We won’t rely on the built-in admin role here; instead, you’ll create your own role to understand how the system works. For example, let's call it `manager`.

## Preparing Your Own Permissions Override

Because module files should never be edited directly, first let's create a local override in your own `app/` directory. The recommended first override is the **permissions configuration**, which defines RBAC roles and permissions for your application.

Run: 

<pre class="command-line" data-user="user" data-host="host"><code class="language-bash">
mkdir -p app/modules/user/public/lib/queries/role_permissions
cp modules/user/public/lib/queries/role_permissions/permissions.liquid \
   app/modules/user/public/lib/queries/role_permissions/permissions.liquid
</code></pre>

This creates a safe override that allows you to define your own roles and permissions without modifying module files directly.

modules/user/.../permissions.liquid
app/modules/user/.../permissions.liquid

When platformOS sees both files: …it automatically prioritizes your app version.

{% include 'alert/tutorial', content: 'For additional setup details and configuration options, refer to the <a href="https://github.com/Platform-OS/pos-module-user?tab=readme-ov-file#setup" target="_blank">User Module README</a> on GitHub.' %}

## Understanding the Permissions File

You should always edit the copy inside your app/ folder, not the one inside modules/.

Now open this permissions file. It contains a JSON structure listing the permissions associated with each role:

#### app/modules/user/public/lib/queries/role_permissions/permissions.liquid

{% raw %}

```liquid
{% parse_json data %}
{
 {% if context.constants.USER_DEFAULT_ROLE != blank %}
 "{{ context.constants.USER_DEFAULT_ROLE }}": [],
 {% endif %}
 "anonymous": ["sessions.create", "users.register"],
 "authenticated": ["sessions.destroy","oauth.manage"],
 "admin": ["admin_pages.view", "admin.users.manage", "users.impersonate"],
 "member": ["profile.manage"],
 "superadmin": ["users.impersonate_superadmin"]
}
{% endparse_json %}

{% return data %}
```
{% endraw %}

We have anonymous, we have authenticated, we have admin, and we have member, and then super admin. So we already have admin. If you wanted to add your role, let's say buyer or seller, for example, for e-commerce or, you know, I don't know, agency manager, something like that, you would just, yes, exactly.
You would just create a new key, and then you would list all of the permissions that they would have.

You can now extend this file with your own custom roles and permissions. So let's do that.

## Creating a Manager Role

So we need to figure out a name for this permission, right? So the convention that we have, but it's not super unified and documented, but the first part of the permission is the resource you want to access, right? In this scenario, it would be admin. So we can call it admin and then dot, and after the dot comes what you want to be able to do with this admin, right? It can be view, it can be manage, it can be, I don't know, list, add, create, delete, for example. Like, it really is up to you to determine how granular the permission should be.
Now, I don't really like to make really granular permissions because I assume that if you can create something, you can probably also edit it and delete it. It may not be the case for everything, but it's a good rule of thumb. So that's why you might often see things like manage.

```json
 "manager": ["admin.view"]
``` 

Like, you have in admin, `admin.users.manage`, right? It means that you can ban users, block them, unblock them, you can edit them, you can change their passwords, you know? You can do everything. So this is like internal manage. So let's say that in admin, we just have admin.manage because we are admin.view. Let's say just admin.view because we want to, for now, have access to the admin panel itself. Yeah, there are admin pages. This comes from Peter's module, I believe, back in the day. You can also use the same, but I want you to create your own permission and your own user rule so you see how everything is sticked together.
So let's stick with admin.view, for example. Or if you have a better idea, you can use your own. Perfect.
So you can save it. OK, great. And now, if you go to admin page, views/pages/admin in the code.

OK, now we need to somehow tell PlatformOS that, OK, only user with this permission should be able to do it. Now, right? And you do it for the code. But 

```json
 "anonymous": ["sessions.create", "users.register"],
 "authenticated": ["sessions.destroy","oauth.manage"],
 "admin": ["admin_pages.view", "admin.users.manage", "users.impersonate"],
 "member": ["profile.manage"],
 "superadmin": ["users.impersonate_superadmin"],
 "manager": ["admin.view"]
}
```
